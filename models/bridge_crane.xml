<mujoco model="BridegeCraneModel">
    <compiler angle="radian" coordinate="local" />

    <option timestep="0.001" gravity="0 0 -9.81" >
        <flag contact="enable" />
    </option>

    <visual>
        <global azimuth="45" elevation="-20" />
        <quality shadowsize="2048" />
        <map znear="0.01" zfar="30" />
    </visual>

    <!-- 顶层 asset（尽量精简，避免兼容性问题） -->
    <asset>
        <texture type="skybox" builtin="gradient" rgb1="0.3 0.5 0.7" rgb2="0 0 0" width="512"
            height="3072" />
        <texture type="2d" name="groundplane" builtin="checker" mark="edge" rgb1="0.2 0.3 0.4"
            rgb2="0.1 0.2 0.3"
            markrgb="0.8 0.8 0.8" width="1000" height="1000" />
        <material name="groundplane" texture="groundplane" texuniform="true" texrepeat="1 1"
            reflectance="0.2" />

        <mesh name="grabber" file="asset/grabber.stl" scale="0.01 0.01 0.01" />
    </asset>

    <worldbody>
        <!-- 模型大小修改后光源可能也要调整 -->
        <light pos="100 0 30" dir="0 0 -1" directional="true" />
        <light pos="-100 0 30" dir="0 0 -1" directional="true" />
        <geom name="floor" size="100 10 0.05" pos= "100 10 0" type="plane" material="groundplane" />

        <!-- 大车机构 -->
        <body name="AxisX_Frame" pos="0 0 20">
            
            <inertial mass="10" pos= "0 0 0" diaginertia="0.1 0.1 0.1"/>
            <joint name="AxisX" type="slide" axis="1 0 0" />
            <!--小车机构 -->
            <body name="AxisY_Frame" pos="0 0 0">
                <camera name="camera1" pos="0 -15 10" xyaxes="1 0 0 0 0.7 0.7" />
                <camera name="camera2" pos="15 0  10" xyaxes="0 1 0 -0.7 0 0.7" />
                <camera name="camera3" pos="0.5 0.5 -0.1" xyaxes="1 0 0 0 1 0" />
                <joint name="AxisY" type="slide" axis="0 1 0" />
                <geom type="box" size="0.5 0.5 0.05"
                    mass="10"
                    rgba="0.92 0.25 0.25 1" />
                <!-- 绳子连接点 -->
               <body name="rope_top" pos="0 0 0.05">
                    <joint name="rope_joint" type="ball" />
                    <site name="site_rope_top1" pos="-0.2 0 0" size="0.02" rgba="0 0 0 0"/>
                    <site name="site_rope_top2" pos="0.4 0 0" size="0.02" rgba="0 0 0 0"/>
                    <!-- 绳子（深灰），作为视觉参考（初始长度 10） -->
                    <geom type="capsule"
                          fromto="0 0 0   0 0 -0.1"
                          size="0.02"
                          mass="0.1"
                          rgba="0.33 0.33 0.33 1" />

                    <!-- 给 Cargo 增加沿绳子方向的 slide joint -->
                    <body name="Cargo" pos="0 0 -5">
+                        <!-- 沿本地 z 轴上下移动 -->
                         
+                        <joint name="AxisZ" type="slide" axis="0 0 1" damping = "20" />
+                        <!-- site 便于运行时抓取位置或用 tendon 可视化 -->
+                        <site name="site_bob1" pos="-0.2 0 0" size="0.02" rgba="0 0 0 0.0"/>
                         <site name="site_bob2" pos="0.4 0 0" size="0.02" rgba="0 0 0 0.0"/>
                         <geom type="mesh" mesh="grabber" 
                             mass="5"
                             rgba="0.95 0.38 0.2 1" />
                    </body>
                </body>
            </body>
        </body>

    </worldbody>
    
    <tendon>
+     <!-- spatial tendon：以 site 列表为路径，可加 wrap objects 实现经过滑轮 -->
+     <spatial name="rope_tendon" width="0.02" rgba="0.33 0.33 0.33 1">
+       <site site="site_rope_top1"/>
+       <site site="site_bob1"/>
+     </spatial>
+     <spatial name="rope_tendon2" width="0.02" rgba="0.33 0.33 0.33 1">
+       <site site="site_rope_top2"/>
+       <site site="site_bob2"/>
+     </spatial>
+   </tendon>

    <!-- 小车执行器 -->
    <actuator>
        <velocity name="velX" joint="AxisX" kv="80" ctrlrange="-2 2" />
        <velocity name="velY" joint="AxisY" kv="80" ctrlrange="-1 1" />
        <velocity name="velZ" joint="AxisZ" kv="40" ctrlrange="-2 2" />
    </actuator>

    <!-- 传感器 -->
    <sensor>
        <!-- 吊物摆角 - 使用frameangvel和framelinvel来计算摆角 -->
        <!-- 测量Cargo相对于世界坐标系的角速度 -->
        <frameangvel name="sensor_cargo_angvel" objtype="body" objname="Cargo" />

        <!-- 通过球关节的位置来获取摆角信息 -->
        <!-- ball joint有3个自由度,对应绕xyz轴的旋转 -->
        <ballquat name="sensor_rope_quat" joint="rope_joint" />
        <ballangvel name="sensor_rope_angvel" joint="rope_joint" />
    </sensor>

</mujoco>